---
title: Weblogic-T3/IIOP Deserialization-RCE CVE-2020-14756
description: CVE-2020-14756 Vulnerability Analysis
categories:
 - Vulnerability Analysis
tags:
 - weblogic
 - T3/IIOP Deserialization
 - CVE-2020-14756
 - RCE
---

## ***Screenshot of Vulnerability Repetition Proof***


![](https://i.imgur.com/jcQrld9.png)

## ***Scope of influence***
Oracle Weblogic Server 12.1.3. 0.0, 12.2. 1.3. 0, 12.2. 1.4. 0, 14.1.1. 0.0

## ***Vulnerability Analysis***
There is an interface `com.tangosol.io.ExternalizableLite `in the `Coherence` component, which is similar to `java.io.Externalizable`. It inherits `java.io.Serializable` and has two methods to implement: `readExternal` and `writeExternal`.

![](https://i.imgur.com/bM6er8G.png)

This interface implements the `readExternal` and `writeExternal `methods of the class for custom serialization and deserialization with the help of `ExternalizableHelper`.

![](https://i.imgur.com/cvw2yed.png)

Let’s take a look at the `readObject` method of `ExternalizableHelper`.

![](https://i.imgur.com/ysmQe5r.png)

`ReadObjectInternal` calls different `read` methods to deserialize according to different `nType` data types, which represent data types that correspond to the number returned by the `getStreamFormat` method when `wrtieObject` serialization is called.

![](https://i.imgur.com/anYMLad.jpg)

![](https://i.imgur.com/1SWrfe6.png)


Follow up the` readExternalizableLite` method, which is used to deserialize objects that implement the `java.io.ExternalizableLite `interface.

![](https://i.imgur.com/mNTkxEt.png)

The method loads and instantiates the class name written on serialization and calls its `readExternal` method.

![](https://i.imgur.com/nRZSwTI.png)

Weblogic filters deserialized classes when the class is loaded, so classes loaded in `readExternalizableLite` are not restricted by blacklists.

That is to say, we can now call the `readExternal `method in the blacklist class. The author used `com.tangosol.coherence.rest.util.extractor.MvelExtractor`, which was used in the previous vulnerability, and implemented the `ExternalizableLite` interface.

![](https://i.imgur.com/BFPZRlS.png)

Its `extract` method can execute `MVEL` expressions, so long as we control `this.m_sExpr` is the expression we want to execute.


![图片2.png](https://i.loli.net/2021/01/27/d6glf3vK49Dnq27.png)

Its `readExternal` method assigns a value to `this.m_sExpr`, and we can control it, so as long as we can call its `extract` method, we can execute arbitrary code.

![image.png](https://i.loli.net/2021/01/27/NKF5pW3IvaxVR9j.png)

The author found the `readExternal` method of `com.tangosol.util.aggregator.TopNAggregator.PartialResult`.

![image.png](https://i.loli.net/2021/01/27/o6hFntY8ucp1drX.png)

`This.instantiateInternalMap (this.m_comparator)` assigns the `TreeMap’s comparator `attribute to `new SortedBag.WrapperComparator (comparator)`, which we can control to be `MvelExtractor`.

![](https://i.imgur.com/GcuQxm0.png)

Follow up` super.add (value)`

![](https://i.imgur.com/kG7O1fp.png)

Eventually, `map.put` is called, and the` map` is the `TreeMap `object assigned above.

![](https://i.imgur.com/ocF5Lpx.png)

Follow up its `compare` method.

![](https://i.imgur.com/lSPqG41.png)

The` Compare` method of `SortedBag.WrapperComparator` is called here.

![](https://i.imgur.com/EPllBYT.png)

Finally, `this.f_comparator.compare` is called, and `this.f_comparator` is the` MvelExtractor` object.

![](https://i.imgur.com/qNpAG8M.png)

Follow up to the compare method of `MvelExtractor` parent class `com.tangosol.util.extractor.AbstractExtractor # compare`, where the `extract` method of `MvelExtractor `is called and any `MVEL `expression is finally executed.

![](https://i.imgur.com/LmLYVFb.png)

However, the `readExternal` method of `com.tangosol.util.aggregator.TopNAggregator.PartialResult` is not called by default because it does not implement the `ExternalizableLite` interface, so you need to find another class that implements the `Externalizable` interface and can call the `ExternalizableHelper.readObject` method.

The author found `com.tangosol.coherence.servlet.AttributeHolder`

![](https://i.imgur.com/H8ifVNT.png)

`ExternalizableHelper.readObject (in)` is called in its `readExternal` method.

![](https://i.imgur.com/y7WgSBu.png)

## ***Call stack***

![](https://i.imgur.com/U1bVoOq.png)

## ***Vulnerability Repair***

1. Install the latest patches.
2. Detect and defend this vulnerability through DAS-Security related products.
3. Disable T3, IIOP protocol.


## ***Author***
> Smi1e@WEBIN.LAB
> DBAPPSecurity
